{
	"$schema": "https://raw.githubusercontent.com/martinring/tmlanguage/master/tmlanguage.json",
	"name": "Tailspin",
	"patterns": [
		{
			"include": "#comment"
		},
		{
			"include": "#matcher"
		},
		{
			"include": "#control"
		},
		{
			"include": "#string"
		},
		{
			"include": "#functions"
		},
		{
			"include": "#inline-function"
		},
		{
			"include": "#structure-literal"
		},
		{
			"include": "#array-literal"
		},
		{
			"include": "#definition"
		},
		{
			"include": "#state-mutation"
		},
		{
			"include": "#number"
		},
		{
			"include": "#reference"
		}
	],
	"repository": {
		"comment": {
			"patterns": [{
				"name": "comment.line.double-slash.tailspin",
				"match": "//[^\\n]*"
			}]
		},
		"control": {
			"patterns": [{
				"name": "keyword.control.tailspin",
				"match": "(->|#|\\b(when|do|rule)\\b|!|\\.\\.\\.)"
			}]
		},
		"string-interpolation": {
			"patterns": [
				{
					"match": "(\\$)(#\\d+)(;)",
					"captures": {
						"1": {"name": "punctuation.interpolation.start.tailspin"},
						"2": {"name": "constant.character"},
						"3": {"name": "punctuation.interpolation.end.tailspin"}
					}
				},
				{
					"name": "meta.string.interpolation.tailspin",
					"begin": "(\\$)(:|(\\w+))?",
					"beginCaptures": {"1": {"name": "punctuation.interpolation.start.tailspin"}, "3": {"name": "variable.name.tailspin"}},
					"end": ";",
					"endCaptures": {"0": {"name": "punctuation.interpolation.end.tailspin"}},
					"patterns": [{"include": "$self"}]
				}
			]
		},
		"string": {
			"begin": "'[^\\$']*",
			"end": "((?<=;)[^\\$']*')|'|^[^\\$']*'",
			"captures": {"0": {"name": "string.quoted.single.tailspin"}},
			"patterns": [
				{
					"match": "\\$\\$",
					"name": "string.quoted.single.tailspin"
				},
				{
					"include": "#string-interpolation"
				},
				{
					"match": "[^\\$]+",
					"name": "string.quoted.single.tailspin"
				}
			]
		},
		"functions": {
			"name": "meta.function.tailspin",
			"begin": "\\b(source|sink|templates|composer|processor)\\b\\s*(\\w+)\\b",
			"end": "\\b(end)\\b\\s*(\\2)\\b",
			"captures": {"1": {"name":"entity.name.type.tailspin"}, "2": {"name": "entity.name.function.tailspin"}},
			"patterns": [
				{
					"name": "meta.parameters.tailspin",
					"begin": "\\@{",
					"beginCaptures": {
						"0": {
							"name": "punctuation.definition.parameters.tailspin"
						}
					},
					"end": "\\}",
					"endCaptures": {
						"0": {
							"name": "punctuation.definition.parameters.tailspin"
						}
					},
					"patterns": [
						{
							"name": "variable.parameter.key.tailspin",
							"match": "\\w+\\s*:"
						}
					]
				},
				{"include": "$self"}
			]
		},
		"inline-function": {
			"name": "meta.function.tailspin",
			"begin": "\\\\(\\w+)?(\\[\\s*\\w+(\\s*;\\s*\\w+)*\\s*\\])?\\(",
			"end": "\\\\(\\1)\\)",
			"captures": {"1": {"name": "entity.name.function.tailspin"}},
			"patterns": [{"include": "$self"}]
		},
		"matcher": {
			"name": "meta.match.tailspin",
			"begin": "<",
			"end": ">",
			"patterns": [
				{
					"include": "#such-that"
				},
				{
					"name": "meta.match.equality.tailspin",
					"begin": "(?:\\s*)=",
					"end": "\\||(?=[?>])",
					"patterns": [
						{
							"include": "#string"
						},
						{
							"include": "#structure-literal"
						},
						{
							"include": "#array-literal"
						},
						{
							"include": "#number"
						},
						{
							"include": "#reference"
						}
					]
				},
				{
					"name": "meta.match.type.tailspin",
					"begin": "(?<=[<|])",
					"end": "\\||(?=[?>])",
					"patterns": [
						{
							"name": "meta.match.type.string.tailspin",
							"begin": "'",
							"end": "'",
							"captures": {"0":{"name": "string.regexp.tailspin"}},
							"patterns": [
								{
									"match": "\\$\\$|''",
									"name": "string.regexp.tailspin"
								},
								{
									"include": "#string-interpolation"
								},
								{
									"match": "[^\\$']+",
									"name": "string.regexp.tailspin"
								}
							]
						},
						{
							"name": "meta.match.type.structure.tailspin",
							"begin": "{",
							"end": "}",
							"patterns": [
							]
						},
						{
							"name": "meta.match.type.array.tailspin",
							"begin": "\\[",
							"end": "\\]",
							"patterns": [
							]
						},
						{
							"name": "meta.match.type.range.tailspin",
							"match": "(-?\\d+~?)?(\\.\\.)(~?-?\\d+)?"
						}
					]
				}
			]
		},
		"such-that": {
			"name": "meta.match.suchthat.tailspin",
			"begin": "\\?\\(",
			"end": "\\)",
			"patterns": [{"include": "$self"}]
		},
		"key": {
			"name": "variable.other.key.tailspin",
			"match": "\\w+\\s*:"
		},
		"structure-literal": {
			"name": "meta.structureliteral.tailspin",
			"begin": "\\{",
			"beginCaptures": {
				"0": {
					"name": "punctuation.definition.block.tailspin"
				}
			},
			"end": "\\}",
			"endCaptures": {
				"0": {
					"name": "punctuation.definition.block.tailspin"
				}
			},
			"patterns": [
				{
					"include": "#key"
				},
				{
					"name": "meta.structureliteral.value.tailspin",
					"begin": "(?<=:)",
					"end": "(?=[,}])",
					"patterns": [{"include": "$self"}]
				}
			]
		},
		"array-literal": {
			"name": "meta.arrayliteral.tailspin",
			"begin": "\\[",
			"beginCaptures": {
				"0": {
					"name": "punctuation.definition.array.tailspin"
				}
			},
			"end": "\\]",
			"endCaptures": {
				"0": {
					"name": "punctuation.definition.array.tailspin"
				}
			},
			"patterns": [
				{
					"name": "meta.arrayliteral.value.tailspin",
					"begin": "(?<=[\\[,])",
					"end": ",|(?=\\])",
					"patterns": [{"include": "$self"}]
				}
			]
		},
		"definition": {
			"name": "meta.definition.tailspin",
			"begin": "\\bdef\\b",
			"beginCaptures": {
				"0": {
					"name": "storage.modifier.definition.tailspin"
				}
			},
			"end": ";",
			"endCaptures": {
				"0": {
					"name": "punctuation.definition.end.tailspin"
				}
			},
			"patterns": [
				{
					"include": "#key"
				},
				{
					"name": "meta.definition.value.tailspin",
					"begin": "(?<=:)",
					"end": "(?=;)",
					"patterns": [{"include": "$self"}]
				}
			]
		},
		"state-mutation": {
			"name": "meta.mutation.state.tailspin",
			"begin": "(\\.\\.\\|)?(@)(?=[^:]*:[^:])",
			"beginCaptures": {
				"1": {
					"name": "keyword.operator.mutation.tailspin"
				},
				"2": {
					"name": "support.type.state.tailspin"
				}
			},
			"end": ";",
			"endCaptures": {
				"0": {
					"name": "punctuation.mutation.end.tailspin"
				}
			},
			"patterns": [
				{
					"name": "meta.mutation.reference.tailspin",
					"begin": "(?<=@)",
					"end": ":",
					"patterns": [
						{"include": "#reference"},
						{
							"name": "variable.other.tailspin",
							"match": "\\w+"
						}
					]
				},
				{
					"name": "meta.mutation.value.tailspin",
					"begin": "(?<=:)",
					"end": "(?=;)",
					"patterns": [{"include": "$self"}]
				}
			]
		},
		"number": {
			"match": "\\d+",
			"captures": {"0": {"name": "constant.numeric.integer.tailspin"}}
		},
		"reference": {
			"patterns": [
				{
					"name": "meta.reference.array.tailspin",
					"begin": "([\\$\\.])(\\w+)\\(",
					"beginCaptures": {
						"1": {"name": "punctuation.reference.tailspin"},
						"2": {"name": "variable.other.tailspin"}
					},
					"end": "\\)"
				},
				{
					"name": "variable.other.tailspin",
					"match": "([\\$\\.])(\\w+)",
					"captures": {
						"1": {"name": "punctuation.reference.tailspin"},
						"2": {"name": "variable.other.tailspin"}
					}
				},
				{
					"name": "meta.reference.array.tailspin",
					"begin": "(\\$)(@)(\\w*)\\(",
					"beginCaptures": {
						"1": {"name": "punctuation.reference.tailspin"},
						"2": {"name": "support.type.state.tailspin"},
						"3": {"name": "variable.other.tailspin"}
					},
					"end": "\\)"
				},
				{
					"match": "(\\$)(@)(\\w*)",
					"captures": {
						"1": {"name": "punctuation.reference.tailspin"},
						"2": {"name": "support.type.state.tailspin"},
						"3": {"name": "variable.other.tailspin"}
					}
				},
				{
					"name": "meta.reference.array.tailspin",
					"begin": "(\\^)(@)(\\w*)\\(",
					"beginCaptures": {
						"1": {"name": "keyword.operator.delete.tailspin"},
						"2": {"name": "support.type.state.tailspin"},
						"3": {"name": "variable.other.tailspin"}
					},
					"end": "\\)"
				},
				{
					"match": "(\\^)(@)(\\w*)",
					"captures": {
						"1": {"name": "keyword.operator.delete.tailspin"},
						"2": {"name": "support.type.state.tailspin"},
						"3": {"name": "variable.other.tailspin"}
					}
				},
				{
					"name": "meta.reference.array.tailspin",
					"begin": "(\\$)\\(",
					"beginCaptures": {
						"1": {"name": "variable.other.currentvalue.tailspin"}
					},
					"end": "\\)"
				},
				{
					"name": "variable.other.currentvalue.tailspin",
					"match": "\\$"
				},
				{
					"name": "variable.other.tailspin",
					"match": "(@)?\\w+(?=[\\.:\\(])",
					"captures": {"1":{"name": "support.type.state.tailspin"}}
				},
				{
					"name": "meta.functioncall.parameterlist.tailspin",
					"begin": "(::)?(\\w+)(@{)",
					"beginCaptures": {
						"1":{"name": "punctuation.message.tailspin"},
						"2":{"name": "entity.name.function.tailspin"},
						"3":{"name": "punctuation.definition.parameters.tailspin"}
					},
					"end": "}",
					"endCaptures": {"0": {"name": "punctuation.definition.parameters.tailspin"}},
					"patterns": [
						{
							"name": "variable.parameter.tailspin",
							"match": "\\w+\\s*:"
						},
						{
							"name": "meta.parameter.value.tailspin",
							"begin": "(?<=:)",
							"end": "(?=[,}])",
							"patterns": [{"include": "$self"}]
						}
					]
						},
				{
					"name": "entity.name.function.tailspin",
					"match": "(::)?\\w+",
					"captures": {"1":{"name": "punctuation.message.tailspin"}}
				}
			]
		}
	},
	"scopeName": "source.tailspin"
}